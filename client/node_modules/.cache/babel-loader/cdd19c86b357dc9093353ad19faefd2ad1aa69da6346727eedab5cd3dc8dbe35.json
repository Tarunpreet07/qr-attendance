{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kaurt\\\\Documents\\\\PROJECTS\\\\qr\\\\client\\\\src\\\\components\\\\MarkAttendance.js\",\n  _s = $RefreshSig$();\n// MarkAttendance.js\nimport React, { useEffect, useRef, useState } from 'react';\nimport { Html5Qrcode } from 'html5-qrcode';\nimport { useSearchParams } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst MarkAttendance = () => {\n  _s();\n  const [message, setMessage] = useState('');\n  const [scanned, setScanned] = useState(false);\n  const qrScannerRef = useRef(null);\n  const [searchParams] = useSearchParams();\n  const sessionId = searchParams.get('sessionId');\n  useEffect(() => {\n    if (!sessionId) {\n      setMessage('❌ Missing session ID in URL');\n      return;\n    }\n    const scanQRCode = async () => {\n      const devices = await Html5Qrcode.getCameras();\n      if (devices && devices.length) {\n        const frontCam = devices.find(device => device.label.toLowerCase().includes('front')) || devices[0];\n        const html5QrCode = new Html5Qrcode(\"qr-reader\");\n        qrScannerRef.current = html5QrCode;\n        html5QrCode.start(frontCam.id, {\n          fps: 10,\n          qrbox: {\n            width: 250,\n            height: 250\n          }\n        }, async decodedText => {\n          if (!scanned) {\n            setScanned(true);\n            console.log(\"Scanned QR Token:\", decodedText);\n            try {\n              const parsed = JSON.parse(decodedText);\n              const qrToken = parsed.qrToken;\n              if (!qrToken) {\n                setMessage(\"❌ Invalid QR Code content.\");\n                return;\n              }\n              const res = await fetch('http://localhost:5000/api/attendance/mark', {\n                method: 'POST',\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                  qrToken,\n                  sessionId\n                })\n              });\n              const result = await res.json();\n              setMessage(result.message || '✅ Attendance marked');\n            } catch (error) {\n              console.error('QR Scan Error or API Error:', error);\n              setMessage('❌ Invalid QR code or server error.');\n            }\n\n            // Allow scanning again after 3 seconds\n            setTimeout(() => setScanned(false), 3000);\n          }\n        }, errorMessage => {\n          console.warn('QR scan error:', errorMessage);\n        }).catch(err => {\n          console.error('Failed to start QR scanner', err);\n          setMessage('❌ Failed to start scanner.');\n        });\n      } else {\n        setMessage(\"❌ No camera found.\");\n      }\n    };\n    scanQRCode();\n\n    // Cleanup on unmount\n    return () => {\n      if (qrScannerRef.current) {\n        qrScannerRef.current.stop().then(() => {\n          qrScannerRef.current.clear();\n          console.log('Scanner stopped.');\n        }).catch(err => {\n          console.warn('Scanner stop error:', err);\n        });\n      }\n    };\n  }, [sessionId, scanned]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '20px'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Mark Attendance\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Align the QR code in the box to scan.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"qr-reader\",\n      style: {\n        width: '300px'\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, this), message && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: /*#__PURE__*/_jsxDEV(\"strong\", {\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 22\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 19\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 5\n  }, this);\n};\n_s(MarkAttendance, \"OI3u62n/3CxDOCKOlxCRdfaNXqs=\", false, function () {\n  return [useSearchParams];\n});\n_c = MarkAttendance;\nexport default MarkAttendance;\nvar _c;\n$RefreshReg$(_c, \"MarkAttendance\");","map":{"version":3,"names":["React","useEffect","useRef","useState","Html5Qrcode","useSearchParams","jsxDEV","_jsxDEV","MarkAttendance","_s","message","setMessage","scanned","setScanned","qrScannerRef","searchParams","sessionId","get","scanQRCode","devices","getCameras","length","frontCam","find","device","label","toLowerCase","includes","html5QrCode","current","start","id","fps","qrbox","width","height","decodedText","console","log","parsed","JSON","parse","qrToken","res","fetch","method","headers","body","stringify","result","json","error","setTimeout","errorMessage","warn","catch","err","stop","then","clear","style","padding","children","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/kaurt/Documents/PROJECTS/qr/client/src/components/MarkAttendance.js"],"sourcesContent":["// MarkAttendance.js\r\nimport React, { useEffect, useRef, useState } from 'react';\r\nimport { Html5Qrcode } from 'html5-qrcode';\r\nimport { useSearchParams } from 'react-router-dom';\r\n\r\nconst MarkAttendance = () => {\r\n  const [message, setMessage] = useState('');\r\n  const [scanned, setScanned] = useState(false);\r\n  const qrScannerRef = useRef(null);\r\n  const [searchParams] = useSearchParams();\r\n  const sessionId = searchParams.get('sessionId');\r\n\r\n  useEffect(() => {\r\n    if (!sessionId) {\r\n      setMessage('❌ Missing session ID in URL');\r\n      return;\r\n    }\r\n\r\n    const scanQRCode = async () => {\r\n      const devices = await Html5Qrcode.getCameras();\r\n      if (devices && devices.length) {\r\n        const frontCam = devices.find(device =>\r\n          device.label.toLowerCase().includes('front')\r\n        ) || devices[0];\r\n\r\n        const html5QrCode = new Html5Qrcode(\"qr-reader\");\r\n        qrScannerRef.current = html5QrCode;\r\n\r\n        html5QrCode\r\n          .start(\r\n            frontCam.id,\r\n            { fps: 10, qrbox: { width: 250, height: 250 } },\r\n            async (decodedText) => {\r\n              if (!scanned) {\r\n                setScanned(true);\r\n                console.log(\"Scanned QR Token:\", decodedText);\r\n\r\n                try {\r\n                  const parsed = JSON.parse(decodedText);\r\n                  const qrToken = parsed.qrToken;\r\n\r\n                  if (!qrToken) {\r\n                    setMessage(\"❌ Invalid QR Code content.\");\r\n                    return;\r\n                  }\r\n\r\n                  const res = await fetch('http://localhost:5000/api/attendance/mark', {\r\n                    method: 'POST',\r\n                    headers: { 'Content-Type': 'application/json' },\r\n                    body: JSON.stringify({ qrToken, sessionId }),\r\n                  });\r\n\r\n                  const result = await res.json();\r\n                  setMessage(result.message || '✅ Attendance marked');\r\n                } catch (error) {\r\n                  console.error('QR Scan Error or API Error:', error);\r\n                  setMessage('❌ Invalid QR code or server error.');\r\n                }\r\n\r\n                // Allow scanning again after 3 seconds\r\n                setTimeout(() => setScanned(false), 3000);\r\n              }\r\n            },\r\n            (errorMessage) => {\r\n              console.warn('QR scan error:', errorMessage);\r\n            }\r\n          )\r\n          .catch((err) => {\r\n            console.error('Failed to start QR scanner', err);\r\n            setMessage('❌ Failed to start scanner.');\r\n          });\r\n      } else {\r\n        setMessage(\"❌ No camera found.\");\r\n      }\r\n    };\r\n\r\n    scanQRCode();\r\n\r\n    // Cleanup on unmount\r\n    return () => {\r\n      if (qrScannerRef.current) {\r\n        qrScannerRef.current\r\n          .stop()\r\n          .then(() => {\r\n            qrScannerRef.current.clear();\r\n            console.log('Scanner stopped.');\r\n          })\r\n          .catch((err) => {\r\n            console.warn('Scanner stop error:', err);\r\n          });\r\n      }\r\n    };\r\n  }, [sessionId, scanned]);\r\n\r\n  return (\r\n    <div style={{ padding: '20px' }}>\r\n      <h2>Mark Attendance</h2>\r\n      <p>Align the QR code in the box to scan.</p>\r\n      <div id=\"qr-reader\" style={{ width: '300px' }}></div>\r\n      {message && <p><strong>{message}</strong></p>}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MarkAttendance;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}